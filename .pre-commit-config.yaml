# Pre-commit hooks using prek (https://github.com/j178/prek)
#
# Usage:
#   prek install           Install git hooks
#   prek run --all-files   Run all hooks
#   prek run <id>          Run specific hook
#
# Hook groups (for justfile):
#   fmt      → shfmt, justfmt
#   lint     → shellcheck, json-validate, script-permissions
#   validate → validate-plugins

repos:
  # ┌─────────────────────────────────────────────────────────────────────────┐
  # │ FMT - Formatters (modify files)                                         │
  # └─────────────────────────────────────────────────────────────────────────┘
  - repo: https://github.com/scop/pre-commit-shfmt
    rev: v3.10.0-1
    hooks:
      - id: shfmt
        name: Format shell scripts
        args: ["-i", "2", "-ci", "-w"]
        types: [shell]

  - repo: local
    hooks:
      - id: justfmt
        name: Format justfile
        entry: just --fmt --unstable
        language: system
        files: ^justfile$
        pass_filenames: false

  # ┌─────────────────────────────────────────────────────────────────────────┐
  # │ LINT - Linters (read-only checks)                                       │
  # └─────────────────────────────────────────────────────────────────────────┘
  - repo: https://github.com/koalaman/shellcheck-precommit
    rev: v0.11.0
    hooks:
      - id: shellcheck
        name: Lint shell scripts
        args: ["--severity=warning"]
        types: [shell]

  - repo: local
    hooks:
      - id: json-validate
        name: Lint JSON files
        entry: bash -c 'for f in "$@"; do jq empty "$f" || exit 1; done' _
        language: system
        types: [json]

      - id: script-permissions
        name: Check script permissions
        entry: bash -c 'for f in "$@"; do test -x "$f" || exit 1; done' _
        language: system
        types: [shell]

  # ┌─────────────────────────────────────────────────────────────────────────┐
  # │ VALIDATE - Structure validation                                         │
  # └─────────────────────────────────────────────────────────────────────────┘
      - id: validate-plugins
        name: Validate plugin structure
        entry: scripts/validate-plugins.sh
        language: script
        pass_filenames: false
        always_run: true
